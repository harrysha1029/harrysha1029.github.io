<!doctype html><html><head><title>Song Order - Guitar Tunings and the Travelling Salesperson | Harry Sha</title><meta charset="utf-8"><link href="/prism.css" rel="stylesheet" type="text/css"><script src="/prism.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="//fonts.googleapis.com/css?family=Lato|Open+Sans|Proza+Libre|Inconsolata" rel="stylesheet" type="text/css"></head><body><div class="header-logo"><h2><a href="/home">HS</a></h2></div><div class="navigation"><ul><li><a href="/home">Home</a></li><li><a href="/posts">Blog</a></li><li><a href="/cv">CV</a></li><li><a href="/fun">Fun</a></li><li><a href="/contact">Contact</a></li></ul></div><div class="sidebar"></div><div class="sidebar2"></div><div class="content"><h1>Song Order - Guitar Tunings and the Travelling Salesperson</h1><div class="post-metadata"><span>2020-04-05</span><span>•</span><a href="/tags/guitar">guitar</a><a href="/tags/math">math</a></div><div class="markdown"><p>I play gigs with my acoustic guitar every now and then, and a lot of the pieces I play feature <strong>weird</strong> tunings. So here’s the problem: tuning from one tuning to another very different tuning not only takes a long time it makes the guitar go out of tune more quickly and also increases the risk of broken strings. Thus I want to order my songs such that each jump between tunings isn’t that large!</p>
<h2 id="definitions">Definitions</h2>
<p>Let’s start with some definitions! First in math, then in code. </p>
<ul>
<li>Associate each key on the piano with an integer starting with A0 = 0, Bb0 = 1… and so on.</li>
<li>Define a tuning to be a vector a 6 pitches \( \in \mathbb{Z}^6 \)</li>
<li>For any tunings x, y define their distance to be the <em>‘manhattan distance’</em> or \(L_1\) distance:</li>
</ul>
<p>$$d_{tuning}(x, y) = \sum_{i=1}^6 |x_i - y_i|.$$</p>
<p>Here it is in the rust language.</p>
<pre><code class="language-rust">
enum Note {A, Bb, B, C, Db, D, Eb, E, F, Gb, G, Ab}

struct Pitch(Note, i32); // Note, Octave

type Tuning = [Pitch; 6];
</code></pre>

<p>So to start, we have the <code>Notes</code> type which can take on one of 12 values. Then, we have the <code>Pitch</code> type which is represented as a tuple containing a <code>Note</code> and an octave, e.g. A4. A <em>Tuning</em> is then a list of 6 <em>Pitches</em> (one for each string on the guitar). We associate <code>Pitch</code> values with integers, and define distances as follows.</p>
<pre><code class="language-rust">
fn note2num(note: &amp;Note) -&gt; i32 {
    match note {
        Note::A =&gt; 0,
        Note::Bb =&gt; 1,
        Note::B =&gt; 2,
        ...
        Note::Ab =&gt; 11,
    }
}

impl Pitch {
    fn num(&amp;self) -&gt; i32 {
        note2num(&amp;self.0) + (self.1 * 12)
    }
}

fn pitch_dist(p1: &amp;Pitch, p2: &amp;Pitch) -&gt; i32 {
    (p1.num() - p2.num()).abs()
}

fn tuning_dist(p1: &amp;Tuning, p2: &amp;Tuning) -&gt; i32 {
    p1.iter()
        .zip(p2)
        .map(|(a, b)| pitch_dist(a, b))
        .sum::&lt; i32&gt;()
}
</code></pre>

<h2 id="the-problem">The Problem</h2>
<p>Let’s view this as a graph problem. Let the nodes in the graph be the tunings, and have an edge between each node, with the cost of the edge being the distance between the two tunings. Then <strong>we want to find the ‘shortest’ path that passes through all the nodes</strong>. Not only that, because we want to start and end up in standard tuning, we want to find the ‘shortest’ cycle that passes through all the nodes. <strong>Turns out, this is a famous problem known as the travelling salesperson problem (TSP)</strong>! And it’s pretty hard to solve (NP-Hard). Here is the list of tunings we are working with (there are 14 of them).</p>
<pre><code class="language-rust">
[
    [E2, A3, D3, G3, B3, E4]
    , [D2, A3, D3, G3, A3, D4]
    , [D2, A3, D3, Gb3, A3, D4]
    , [B2, E2, D3, Gb3, A3, D4]
    , [E2, B3, D3, G3, B3, D4]
    , [E2, B3, D3, G3, B3, E4]
    , [B2, Gb2, Db3, Gb3, B3, Gb4]
    , [E2, C3, D3, G3, A3, D4]
    , [D2, A3, D3, G3, C3, E4]
    , [C2, G2, D3, F3, Bb3, D4]
    , [Gb2, A3, B3, E3, Ab2, B4]
    , [Db2, Ab2, E3, Gb3, B3, Eb4]
    , [D2, A3, E3, F3, C3, E4]
    , [D2, G2, D3, G3, B3, E4]
]
</code></pre>

<h2 id="brute-force-search">Brute Force Search</h2>
<p>There are some really <a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem#Computing_a_solution">cool algorithms for TSP</a>. But for my case, the simplest one - brute force - will suffice. This approach is to simply try every single cycle. We have 14 tunings, so how many cycles are there? Well because it’s a cycle, it doesn’t matter with which element it starts/ends with. So fix one, and then pick the order of the remaining 13 tunings (actually there are even fewer because the ‘reverse cycle’ has the same cost but I’ll just ignore this). Thus we have \(13! = 6,227,020,800\) tunings cycles to look through! The brute force search algorithm is implemented here.</p>
<pre><code class="language-rust">
fn brute_force(tunings: &amp;Vec<tuning>) -&gt; (i32, Vec<usize>) {
    let len = tunings.len();
    let first = &amp;tunings[0];
    (1..len)
        .into_iter()
        .permutations(len - 1)
        .progress_count(fact((len as i32) - 1)) // Loading bar
        .map(|ord| (tuning_seq_dist_ord(tunings, &amp;first, &amp;ord), ord))
        .min_by_key(|x| x.0)
        .unwrap()
}
</usize></tuning></code></pre>

<p>After running this, we found that the following cycle was optimal with weight 84 :)</p>
<pre><code class="language-rust">
[E2, A3, D3, G3, B3, E4]
[E2, B3, D3, G3, B3, E4]
[E2, B3, D3, G3, B3, D4]
[E2, C3, D3, G3, A3, D4]
[D2, A3, D3, G3, A3, D4]
[D2, A3, D3, Gb3, A3, D4]
[Gb2, A3, B3, E3, Ab2, B4]
[C2, G2, D3, F3, Bb3, D4]
[B2, E2, D3, Gb3, A3, D4]
[B2, Gb2, Db3, Gb3, B3, Gb4]
[Db2, Ab2, E3, Gb3, B3, Eb4]
[D2, A3, E3, F3, C3, E4]
[D2, A3, D3, G3, C3, E4]
[D2, G2, D3, G3, B3, E4]
[E2, A3, D3, G3, B3, E4]
</code></pre>

<p>Yay.</p>
</div></div><div class="footer"><div class="link"><a href="https://github.com/harrysha1029"><svg class="feather feather-github" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></div><div class="link"><a href="https://www.youtube.com/channel/UCVjPFH1nsdSB03heP0Al36A?view_as=subscriber"><svg class="feather feather-youtube" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg></a></div><div class="link"><a href="https://www.linkedin.com/in/harry-sha-374345145/"><svg class="feather feather-linkedin" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a></div><div class="link"><a href="https://www.facebook.com/harry.sha.12"><svg class="feather feather-facebook" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a></div><div class="link"><a href="https://www.npmjs.com/package/elmstatic">Created with Elmstatic</a></div></div><link href="/styles.css" rel="stylesheet" type="text/css"><style>body {
    padding:0px;
    margin:0px;
    background-color:#ffffff;
    color:#363636;
    font-family:Lato, sans-serif;
    font-size:20px;
    line-height:1.4em;
}

a {
    color:#348aa7;
    text-decoration:none;
}

code {
    font-family:Inconsolata, monospace;
}

pre  code {
    overflow-x:scroll !important;
}

h1, h2, h3, h4, h5, h6 {
    font-family:Lato, sans-serif;
    line-height:1.1em;
}

h1 {
    font-size:2.66667em;
    margin-bottom:2.0202rem;
}

h2 {
    font-size:2em;
    margin-bottom:1.61616rem;
}

h3 {
    font-size:1.33333em;
    margin-bottom:1.21212rem;
    color:#0e4f99;
}

h4 {
    font-size:1.2em;
    margin-bottom:0.80808rem;
}

h5, h6 {
    font-size:1em;
    margin-bottom:0.60606rem;
}

p {
    margin:auto auto 1.5rem;
}

small {
    font-size:65%;
}

.header-logo {
    text-align:center;
    padding:10px;
    margin-top:-15px;
    border-bottom:2px solid #8295a1;
    background-color:#87ffe9;
}

.header-logo  a {
    color:#363636;
    margin-left:10px;
}

@media only screen and (min-width: 600px) {
    .header-logo {
        text-align:left;
    }
}

.navigation {
    text-align:center;
    border-bottom:2px solid #8295a1;
    background-color:#87ffe9;
    padding:10px;
    margin-top:-20px;
}

@media only screen and (min-width: 600px) {
    .navigation {
        margin-top:0px;
    padding:0px;
    text-align:right;
    }
}

.navigation  ul {
    margin:0px;
    padding:0px;
}

@media only screen and (min-width: 600px) {
    .navigation  ul {
        line-height:100px;
    }
}

.navigation  li {
    display:inline-block;
    margin-right:40px;
}

.navigation  a {
    color:#363636;
}

.content {
    max-width:100vw;
}

.footer {
    text-align:center;
    border-top:2px solid #2f4858;
    background-color:#87f1ff;
}

@media only screen and (min-width: 600px) {
    .footer {
        line-height:80px;
    text-align:right;
    }
}

@media only screen and (min-width: 600px) {
    .footer  .link {
        display:inline-block;
    margin-right:20px;
    }
}

.footer  a {
    color:#000000;
    text-decoration:none;
}

.footer  svg {
    padding-right:5px;
    vertical-align:baseline;
}

.post-metadata {
    margin-top:-0.5em;
    margin-bottom:2em;
}

.post-metadata  a, .post-metadata  span {
    display:inline-block;
    margin-right:5px;
}

.post-metadata  a {
    border:1px solid #e0e0e0;
    border-radius:3px;
    background-color:#f2fae8;
    padding-left:5px;
    padding-right:5px;
}</style></body></html>